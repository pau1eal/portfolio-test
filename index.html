<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Galería · pauleal · ArtStation</title>
  <style>
    :root{
      --bg: #0b0c10;
      --card: #111218;
      --muted: #8a8f98;
      --text: #e6e8eb;
      --accent: #6be675;
      --ring: #2a2e35;
    }
    *{box-sizing: border-box}
    body{margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial; background: var(--bg); color: var(--text)}
    header{
      position: sticky; top:0; z-index: 10;
      backdrop-filter: blur(8px);
      background: color-mix(in oklab, var(--bg) 85%, #000 15% / 60%);
      border-bottom: 1px solid var(--ring);
    }
    .wrap{max-width:1200px; margin:0 auto; padding:16px}
    h1{font-size: clamp(1.1rem, 1.5vw + 1rem, 1.8rem); margin:0; letter-spacing:.3px}
    .sub{color: var(--muted); font-size:.95rem; margin-top:6px}

    .notice{display:none; margin:12px 0 0; padding:10px 12px; border:1px dashed var(--ring); border-radius:12px; color: var(--muted)}

    .grid{display:grid; gap:14px; padding:18px 16px 32px}
    @media (min-width:480px){ .grid{ grid-template-columns: repeat(2, 1fr);} }
    @media (min-width:768px){ .grid{ grid-template-columns: repeat(3, 1fr);} }
    @media (min-width:1024px){ .grid{ grid-template-columns: repeat(4, 1fr);} }

    .card{
      background: var(--card);
      border: 1px solid var(--ring);
      border-radius: 16px; overflow: hidden;
      transition: transform .16s ease, box-shadow .16s ease, border-color .16s ease;
    }
    .card:hover{ transform: translateY(-2px); border-color: color-mix(in oklab, var(--ring), var(--accent) 25%); box-shadow: 0 10px 30px rgba(0,0,0,.25)}
    .thumb{ display:block; aspect-ratio: 16/10; width:100%; object-fit: cover; background:#0a0a0a }
    .title{ margin:10px 12px 12px; font-size:.98rem; line-height:1.35; color: var(--text)}

    .skeleton{ position:relative; overflow:hidden; }
    .skeleton::after{
      content:""; position:absolute; inset:0; 
      background: linear-gradient(100deg, transparent 20%, rgba(255,255,255,.06) 40%, transparent 60%);
      animation: shimmer 1.2s infinite;
    }
    @keyframes shimmer{ 0%{ transform: translateX(-100%)} 100%{ transform: translateX(100%)} }

    .footer{ text-align:center; color: var(--muted); padding: 8px 16px 24px }
    a{ color: inherit; text-decoration: none }
    .btn{display:inline-flex; align-items:center; gap:8px; border:1px solid var(--ring); padding:8px 12px; border-radius:999px}
    .btn:hover{ border-color: color-mix(in oklab, var(--ring), var(--accent) 40%) }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>Proyectos de ArtStation — pauleal</h1>
      <p class="sub">Cargando automáticamente la portada de cada proyecto. Haz clic para abrir en ArtStation.</p>
      <div id="notice" class="notice">Parece que has abierto este archivo directamente con <code>file://</code>. Algunas peticiones externas pueden fallar por CORS. Sube este archivo a un servidor (GitHub Pages, Netlify, Vercel) o lánzalo con un servidor local (ej. <code>npx serve</code>).</div>
    </div>
  </header>

  <main class="wrap">
    <section id="grid" class="grid"></section>
    <div class="footer">
      <a class="btn" href="https://www.artstation.com/pauleal" target="_blank" rel="noopener">Ver perfil en ArtStation</a>
    </div>
  </main>

  <script>
    const USER = "pauleal"; // <- tu usuario de ArtStation

    const grid = document.getElementById('grid');
    const notice = document.getElementById('notice');

    if (location.protocol === 'file:') {
      notice.style.display = 'block';
    }

    // Render placeholders
    const PLACEHOLDERS = 8;
    for (let i = 0; i < PLACEHOLDERS; i++) {
      const ph = document.createElement('div');
      ph.className = 'card';
      ph.innerHTML = `<div class="thumb skeleton"></div><div class="title skeleton" style="height: 16px; margin: 12px"></div>`;
      grid.appendChild(ph);
    }

    async function fetchPage(page = 1) {
      const url = `https://www.artstation.com/users/${USER}/projects.json?page=${page}`;
      const res = await fetch(url, { headers: { 'Accept': 'application/json' }});
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      return res.json();
    }

    function imageFrom(project) {
      // Preferimos la de mayor tamaño disponible entre estas claves habituales
      const cover = project.cover || {};
      return cover.image_url || cover.medium_image_url || cover.small_image_url || cover.url || project.cover_url || '';
    }

    function renderProjects(projects) {
      grid.innerHTML = '';
      for (const p of projects) {
        const img = imageFrom(p);
        const link = p.permalink || p.url || `https://www.artstation.com/artwork/${p.hash_id || ''}`;
        const title = (p.title || 'Proyecto sin título').replace(/</g, '&lt;').replace(/>/g, '&gt;');
        const card = document.createElement('a');
        card.href = link;
        card.target = '_blank';
        card.rel = 'noopener';
        card.className = 'card';
        card.innerHTML = `
          <img class="thumb" loading="lazy" decoding="async" src="${img}" alt="${title}" />
          <div class="title">${title}</div>
        `;
        grid.appendChild(card);
      }
    }

    async function loadAll() {
      try {
        let page = 1;
        let all = [];
        while (true) {
          const json = await fetchPage(page);
          const items = Array.isArray(json.data) ? json.data : [];
          if (!items.length) break;
          all = all.concat(items);
          // si hay paginación, suele venir json.per_page y json.total_count
          if (json.per_page && json.total_count) {
            const totalPages = Math.ceil(json.total_count / json.per_page);
            if (page >= totalPages) break;
          } else if (items.length < 50) { // heurística defensiva
            break;
          }
          page++;
        }
        if (!all.length) {
          grid.innerHTML = '<p style="color: var(--muted)">No se encontraron proyectos.</p>';
          return;
        }
        renderProjects(all);
      } catch (err) {
        console.error(err);
        grid.innerHTML = `<p style="color:#f88">Error al cargar proyectos (${err.message}). ¿Estás abriendo el archivo con <code>file://</code>? Prueba a servirlo desde un dominio o un servidor local.</p>`;
      }
    }

    loadAll();
  </script>
</body>
</html>
